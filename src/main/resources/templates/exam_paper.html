<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">

<title>在线考试系统</title>

<!-- Bootstrap Core CSS -->
<link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

<!-- MetisMenu CSS -->
<link href="vendor/metisMenu/metisMenu.min.css" rel="stylesheet">

<!-- DataTables CSS -->
<link href="vendor/datatables-plugins/dataTables.bootstrap.css"
	rel="stylesheet">

<!-- DataTables Responsive CSS -->
<link href="vendor/datatables-responsive/dataTables.responsive.css"
	rel="stylesheet">

<!-- Custom CSS -->
<link href="dist/css/sb-admin-2.css" rel="stylesheet">

<!-- Custom Fonts -->
<link href="vendor/font-awesome/css/font-awesome.min.css"
	rel="stylesheet" type="text/css">
	
<style>
	label {
	    display: inline-block;
	    max-width: 100%;
	    margin-bottom: 5px;
	    font-weight: 700;
	    font-size: 22px;
	}
</style>
</head>

<body>
	<div id="wrapper">
		<!-- Navigation -->
		<nav class="navbar navbar-default navbar-static-top" role="navigation"
			style="margin-bottom: 0">
			<div class="navbar-header">
				<a class="navbar-brand" href="#">在线考试系统</a>
			</div>
			<ul class="nav navbar-top-links navbar-right">
				<!-- /.dropdown -->
				<li class="dropdown"><a class="dropdown-toggle"
					data-toggle="dropdown" href="#" aria-expanded="false">
					<label id="username" style="font-size: 14px;"></label>
						<i class="fa fa-user fa-fw"></i> <i class="fa fa-caret-down"></i>
				</a>
					<ul class="dropdown-menu dropdown-user">
						<li><a href="#"><i class="fa fa-user fa-fw"></i> 用户资料</a></li>
						<li><a href="#"><i class="fa fa-gear fa-fw"></i> 设置</a></li>
						<li class="divider"></li>
						<li><a href="login.html"><i class="fa fa-sign-out fa-fw"></i>
								退出登陆</a></li>
					</ul> <!-- /.dropdown-user --></li>
				<!-- /.dropdown -->
			</ul>
		</nav>
	</div>
	<div class="row" style="margin-left:0px;margin-right:0px;">
		<div class="col-lg-12">
			<br>
			<div class="panel panel-primary">
				<div class="panel-body">
					<form id="parameterId" role="form">
					<div class="form-group">
					<fieldset>
						<label class="col-sm-1">科目:</label>
						<div class="col-sm-2">
							<select name="subjectCode" id="subjectId" class="form-control">
							<option value="101">数学</option>
							<option value="102">语文</option>
							</select>
						</div>
						<div class="col-sm-1">
						<button id="start" type="button" class="btn btn-primary">开始考试</button>
						</div>
						<label class="col-sm-1">时间:</label>
						<div style="font-size:22px;" class="col-sm-3">
							<strong id="hh"></strong>时
							<strong id="mm"></strong>分
							<strong id="ss"></strong>秒
						</div>
						
						<label class="col-sm-1">分数:</label>
						<div class="col-sm-3">
							
						</div>
						</fieldset>
					</div>
					</form>
					
				</div>
			</div>
			<div id="panel1" class="panel panel-primary hidden">
				<div class="panel-heading">
					一、选择题（100分）
				</div>
				<div class="panel-body">
					<div class="row">
						<div class="col-lg-12">
							<form id="examFormId" role="form">
								<!-- <div class="form-group">
									<label>1.下面四个算式中（）的结果最大。（a是不等于0的自然数）</label>
									<div class="radio">
										<label class="radio-inline clearfix">
											<input name="q1" type="radio" value="A">A. a－56
										</label>
										<label class="radio-inline clearfix">
											<input name="q1" type="radio" value="B">B. a×56
										</label>
										<label class="radio-inline clearfix">
											<input name="q1" type="radio" value="C">C. a＋56
										</label>
										<label class="radio-inline clearfix">
											<input name="q1" type="radio" value="D">D. 无法确定
										</label>
									</div>
								</div> -->
								
							</form>
							<div class="col-sm-4"></div>
							<div class="col-sm-4">
								<button id="subitId" type="button" class="btn btn-primary btn-lg btn-block">提交</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- jQuery -->
	<script src="vendor/jquery/jquery.min.js"></script>

	<!-- Bootstrap Core JavaScript -->
	<script src="vendor/bootstrap/js/bootstrap.min.js"></script>

	<!-- Metis Menu Plugin JavaScript -->
	<script src="vendor/metisMenu/metisMenu.min.js"></script>
	
	<script>

	var nMS = 1;
    function GetRTime(){  
        
        nMS = nMS-1;
        //小时  
        var nH = Math.floor(nMS/(60*60));  
        //分钟  
        var nM = Math.floor(nMS/(60)) % 60;  
        //秒钟  
        var nS = Math.floor(nMS) % 60;  
        //显示小时     
        $("#hh").text(nH);  
        //显示分钟
        $("#mm").text(nM);  
        //显示秒钟  
        $("#ss").text(nS);   
    }

	$(document).ready(function() {
		//get user info
		
		$.ajax({
			type: "get",
			url: "user/info",
			success: function(data) {
				if (data.success==1) {
					$("#username").html(data.data.username);
				} else {
					alert("请登陆");
					window.location.href = "login.html";
				}
			}
		});
		GetRTime();
		$("#start").click(function(){
			$.ajax({
				type: "get",
				url: "user/getParameter",
				data: $("#parameterId").serialize(),
				async: true,
				error: function(textStatus, data){
					alert("\ntextStatus: " + textStatus +
							"\nsuccess: " + data.success);
					return;
				},
				success: function(data) {
					if (data.success==1) {
						for (var i = 0; i < data.data.length; i++) {
							if (data.data[i].code_subject == $("#subjectId").val()) {
								nMS = data.data[i].time_exam*60;
								console.log(data.data[i].time_exam);
								return;
							}
						}
					}
				}
			});
			$.ajax({
				type: "get",
				url: "user/createPaper",
				data: $("#parameterId").serialize(),
				async: true,
				success: function(data) {
					if (data.success==1) {
						alert(data.msg);
					} else {
						alert(data.msg);
					}
				}
			});
			$.ajax({
				type: "get",
				url: "user/getPaper",
				success: function(data) {
					if (data.success==1) {
						//console.log(data.data.data_paper);
						var paper = eval('(' + data.data.data_paper + ')');
						for (var i = 0; i < paper.length; i++) {
							var question = paper[i].question;
							//console.log(paper[i].question);
							
							var arr = question.split("#");
							console.log((i+1) + ". ");
							for (var j = 0; j < arr.length; j++) {
								console.log(arr[j] + " ");
								
							}
							$("#examFormId").append(
							    	"<div class=\"form-group\">" + 
								"<label>"+(i+1)+"."+arr[0]+"</label>" +
								"<div class=\"radio\">" +
									"<label class=\"radio-inline clearfix\">"+
										"<input name=\"q"+(i+1)+"\" type=\"radio\" value=\"A\">"+arr[1]+
									"</label>"+
									"<label class=\"radio-inline clearfix\">"+
										"<input name=\"q"+(i+1)+"\" type=\"radio\" value=\"B\">"+arr[2]+
									"</label>"+
									"<label class=\"radio-inline clearfix\">"+
										"<input name=\"q"+(i+1)+"\" type=\"radio\" value=\"C\">"+arr[3]+
									"</label>"+
									"<label class=\"radio-inline clearfix\">"+
										"<input name=\"q"+(i+1)+"\" type=\"radio\" value=\"D\">"+arr[4]+
									"</label></div></div>"
							);
						}
					} else {
						alert(data.msg);
					}
				}
			});
			var timer_rt = window.setInterval("GetRTime()", 1000);
			$("#panel1").attr("class","panel panel-primary");
			//$("#start").attr("class","btn btn-primary disabled");
			//$("#subjectId").attr("class","form-control disabled");
			$("fieldset").attr("disabled","");
			
		});
	});
	</script>
</body>
</html>